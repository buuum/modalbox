var modalbox,bind=function(a,b){return function(){return a.apply(b,arguments)}};modalbox=function(){function a(){this.onShow=bind(this.onShow,this),this.onClose=bind(this.onClose,this),$(window).resize(function(a){return function(){a.resize()}}(this)),$("body").on("click",".modal__box__close",function(a){return function(b){b.preventDefault(),a.close()}}(this)),$("body").on("click",".modal__overlay",function(a){return function(b){b.preventDefault(),a.options.closeoverlay&&a.close()}}(this))}return a.prototype.onClose=function(a){$("html").css("overflow-y","auto"),$("body").css("overflow-y","auto"),this.prefixedRemoveEventListener($(".modal__content"),"AnimationEnd",this.onClose),$(".modal__box").remove(),this.options.onclose()},a.prototype.close=function(){$(".modal__content").removeClass(this.options.show),$(".modal__content").addClass(this.options.close),$(".modal__box").find(".modal__overlay").removeClass("show_opacity"),$(".modal__box").find(".modal__overlay").addClass("hide_opacity"),this.prefixedEventListener($(".modal__content"),"AnimationEnd",this.onClose)},a.prototype.setOptions=function(a){null==a&&(a={}),this.div=!1,this.clone=!1,this.pfx=["webkit","moz","MS","o",""],this.options={ajax:!1,classload:!1,classcontainer:!1,htmlload:!1,closeoverlay:!0,overlaycolor:"#fff",show:"show_scale",close:"hide_scale",onclose:function(){}},this.options=this.merge(this.options,a)},a.prototype.ini=function(){var a,b,c,d,e,f;a=$('<div class="modal__box" />'),f=$('<div class="modal__overlay" />'),f.css("background-color",this.options.overlaycolor),c=$('<div class="modal__dialog" />'),b=$('<div class="modal__content" />'),e=$('<div class="modal__loading" />'),d=$('<div class="spinner spinner-bounce-middle" />'),$(".modal__box").length<=0&&(c.append(b),a.append(f),a.append(c),$("body").append(a)),$(".modal__content").html(""),$(".modal__box").find(".modal__overlay").removeClass("hide_opacity"),this.options.ajax?(e.append(d),$(".modal__content").append(e),$(".modal__box").find(".modal__overlay").addClass("show_opacity"),this.resize(),this.openmodal()):this.options.classload?(this.clone=$(this.options.classload).clone(),this.options.classcontainer=this.options.classload,this.div=this.clone,$(".modal__box").find(".modal__overlay").addClass("show_opacity"),this.start_modal()):(this.clone=$(this.options.htmlload).clone(),this.options.classcontainer=this.clone.attr("class"),this.div=this.clone,$(".modal__box").find(".modal__overlay").addClass("show_opacity"),this.start_modal())},a.prototype.content=function(a){return this.div=$("<div />"),this.div.addClass(this.options.classcontainer),this.div.append(a),this.start_modal()},a.prototype.openmodal=function(){this.options.ajax?Api.getData({url:this.options.ajax},function(a){return function(b,c){c||(b.error?(a.div=$('<div class="modal_default"></div>'),a.div.html(b.message),a.start_modal()):(a.div=$(b.html),a.options.classcontainer=a.div.attr("class"),a.clone=$(a.div).clone(),a.clone.css("visibility","hidden"),$("body").append(a.clone),a.loaded_imgs=0,a.total_imgs=a.clone.find("img").length,a.total_imgs>0?$.each(a.clone.find("img"),function(b,c){$(c).one("load",function(){a.imageLoaded()})}):a.start_modal()))}}(this)):this.resize()},a.prototype.start_modal=function(){this.clone&&this.clone.remove(),$(this.div).css("display","block"),$(".modal__content").html(this.div),this.prefixedEventListener($(".modal__content"),"AnimationEnd",this.onShow),$(".modal__content").addClass(this.options.show),this.resize()},a.prototype.onShow=function(a){$(".modal__content").removeClass(this.options.show),this.prefixedRemoveEventListener($(".modal__content"),"AnimationEnd",this.onShow)},a.prototype.imageLoaded=function(){this.loaded_imgs++,this.loaded_imgs===this.total_imgs&&this.start_modal()},a.prototype.resize=function(){var a,b,c;$(".modal__box").length>0&&(a=$(".modal__content"),b=this.realSizes(a),b.height>b.window_h?(a.css("top",0),c="20px",$("html").css("overflow-y","hidden"),$("body").css("overflow-y","hidden")):(a.css("top",b.window_h/2-b.height/2+"px"),c=0,$("html").css("overflow-y","auto"),$("body").css("overflow-y","auto")),b.window_w>b.width?a.css("left",b.window_w/2-b.width/2+"px"):a.css("left",0),$(".modal__dialog").css("margin",c+" auto"))},a.prototype.merge=function(a,b){return null==a&&(a={}),null==b&&(b={}),$.extend({},a,b)},a.prototype.realSizes=function(a,b){var c,d,e,f,g,h,i;return null==b&&(b=!1),h=window.innerWidth,d=window.innerHeight,i=$("body").innerWidth(),e=$("body").innerHeight(),f=a.css("position"),"absolute"===f&&a.css("position","relative"),b?(g=a.find(b).outerWidth(),c=a.find(b).outerHeight()):(g=a.outerWidth(),c=a.outerHeight()),"absolute"===f&&a.css("position",f),{window_w:h,window_h:d,body_w:i,body_h:e,width:g,height:c}},a.prototype.prefixedEventListener=function(a,b,c){var d;for(d=0;d<this.pfx.length;)this.pfx[d]||(b=b.toLowerCase()),a[0].addEventListener(this.pfx[d]+b,c,!1),d++},a.prototype.prefixedRemoveEventListener=function(a,b,c){var d;for(d=0;d<this.pfx.length;)this.pfx[d]||(b=b.toLowerCase()),a[0]&&a[0].removeEventListener(this.pfx[d]+b,c,!1),d++},a}();