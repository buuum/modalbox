var modalbox,bind=function(o,t){return function(){return o.apply(t,arguments)}};modalbox=function(){function o(){this.onShow=bind(this.onShow,this),this.onClose=bind(this.onClose,this),this.htmloverflowy=$("html").css("overflow-y")}return o.prototype.onClose=function(o){this.prefixedRemoveEventListener($(".modal__content"),"AnimationEnd",this.onClose),$(".modal__box").remove(),this.options.onClose()},o.prototype.close=function(){this.options.hidebodyscroll&&($("html").css("overflow-y",this.htmloverflowy),$("body").removeClass("buuummodal_open")),$(".modal__content").removeClass(this.options.show),$(".modal__content").addClass(this.options.close),$(".modal__box").find(".modal__overlay").removeClass("show_buuummodal_opacity"),$(".modal__box").find(".modal__overlay").addClass("hide_buuummodal_opacity"),this.prefixedEventListener($(".modal__content"),"AnimationEnd",this.onClose)},o.prototype.setOptions=function(o){null==o&&(o={}),this.div=!1,this.clone=!1,this.pfx=["webkit","moz","MS","o",""],this.options={ajax:!1,classload:!1,classcontainer:!1,htmlload:!1,closeoverlay:!0,width:!1,maxwidth:!1,minwidth:!1,fixheight:!1,overlaycolor:"#fff",hidebodyscroll:!0,position:"center",show:"show_buuummodal_scale",close:"hide_buuummodal_scale",onClose:function(){},onLoad:function(){}},this.options=this.merge(this.options,o)},o.prototype.ini=function(){var o,t,i,s,n,e,a;o=$('<div class="modal__box" />'),(e=$('<div class="modal__overlay" />')).css("background-color",this.options.overlaycolor),i=$('<div class="modal__dialog" />'),t=$('<div class="modal__content" />'),n=$('<div class="modal__loading" />'),s=$('<div class="spinner spinner-bounce-middle" />'),this.iniEvents(),$(".modal__box").length<=0&&(i.append(t),o.append(e),o.append(i),$("body").append(o)),$(".modal__content").html(""),$(".modal__box").find(".modal__overlay").removeClass("hide_buuummodal_opacity"),this.options.hidebodyscroll&&($("html").css("overflow-y","hidden"),$("body").addClass("buuummodal_open")),this.options.ajax?(n.append(s),$(".modal__content").append(n),$(".modal__box").find(".modal__overlay").addClass("show_buuummodal_opacity"),this.openmodal()):this.options.classload?(this.clone=$(this.options.classload).clone(),this.options.classcontainer=this.options.classload,this.div=this.clone,$(".modal__box").find(".modal__overlay").addClass("show_buuummodal_opacity"),this.clone=$(this.div).clone(),this.clone.css("visibility","hidden"),this.clone.find("script").remove(),$("body").append(this.clone),this.loaded_imgs=0,this.total_imgs=this.clone.find("img").length,this.total_imgs>0?$.each(this.clone.find("img"),(a=this,function(o,t){$(t).one("load",function(){a.imageLoaded()}),$(t).one("error",function(){a.imageLoaded()})})):this.start_modal()):(this.clone=$(this.options.htmlload).clone(),this.options.classcontainer=this.clone.attr("class"),this.div=this.clone,$(".modal__box").find(".modal__overlay").addClass("show_buuummodal_opacity"),this.start_modal())},o.prototype.changeContent=function(o,t){return null==t&&(t=!1),$(".modal__content").html(""),this.clone=$(o).clone(),this.options.classcontainer=this.clone.attr("class"),this.div=this.clone,this.start_modal(t)},o.prototype.iniEvents=function(){var o;return $(window).resize((o=this,function(){o.resize()})),$("body").one("click",".modal__box__close",function(o){return function(t){t.preventDefault(),o.close()}}(this)),$("body").one("click",".modal__overlay",function(o){return function(t){t.preventDefault(),o.options.closeoverlay&&o.close()}}(this))},o.prototype.content=function(o){return this.div=$("<div />"),this.div.addClass(this.options.classcontainer),this.div.append(o),this.start_modal()},o.prototype.openmodal=function(){var o;this.is_loading=!0,this.resize(),this.is_loading=!1,this.options.ajax?$.ajax({method:"GET",url:this.options.ajax,dataType:"json"}).success((o=this,function(t){t.error?(o.div=$('<div class="modal_default"></div>'),o.div.html(t.message),o.start_modal()):(o.div=$(t.html),o.options.classcontainer=o.div.attr("class"),o.clone=$(o.div).clone(),o.clone.css("visibility","hidden"),o.clone.find("script").remove(),$("body").append(o.clone),o.loaded_imgs=0,o.total_imgs=o.clone.find("img").length,o.total_imgs>0?$.each(o.clone.find("img"),function(t,i){$(i).one("load",function(){o.imageLoaded()}),$(i).one("error",function(){o.imageLoaded()})}):o.start_modal())})):this.resize()},o.prototype.start_modal=function(o){null==o&&(o=!0),this.clone&&this.clone.remove(),$(this.div).css("display","block"),$(".modal__content").html(this.div),o&&(this.prefixedEventListener($(".modal__content"),"AnimationEnd",this.onShow),$(".modal__content").addClass(this.options.show)),this.resize(),this.options.onLoad()},o.prototype.onShow=function(o){$(".modal__content").removeClass(this.options.show),this.prefixedRemoveEventListener($(".modal__content"),"AnimationEnd",this.onShow)},o.prototype.imageLoaded=function(){this.loaded_imgs++,this.loaded_imgs===this.total_imgs&&this.start_modal()},o.prototype.resize=function(){var o,t,i;$(".modal__box").length>0&&(o=$(".modal__content"),(t=this.realSizes(o)).height>t.window_h?(o.css("top",0),i="0"):"top"===this.options.position?(o.css("top",0),i="0"):(o.css("top",t.window_h/2-t.height/2+"px"),i=0),this.options.fixheight&&!this.is_loading&&o.css("top",0),o.css("left",0),t.window_w>t.width&&o.css("margin","0 "+(t.window_w/2-t.width/2)+"px"),$(".modal__dialog").css("margin",i+" auto"))},o.prototype.merge=function(o,t){return null==o&&(o={}),null==t&&(t={}),$.extend({},o,t)},o.prototype.realSizes=function(o,t){var i,s,n,e,a,d,l,h,c,r;return null==t&&(t=!1),c=window.innerWidth,n=window.innerHeight,r=$("body").innerWidth(),e=$("body").innerHeight(),"absolute"===(l=o.css("position"))&&o.css("position","relative"),this.options.width&&o.css("width",this.options.width),this.options.maxwidth&&o.css("max-width",this.options.maxwidth),this.options.minwidth&&o.css("min-width",this.options.minwidth),i=o.children(),d=parseInt(i.first().css("margin-top")),a=parseInt(i.first().css("margin-bottom"))+d,d=parseInt(i.first().css("padding-top")),a+=parseInt(i.first().css("padding-bottom"))+d,this.options.fixheight&&!this.is_loading&&i.first().css("height",n-a),t?(h=o.find(t).outerWidth(),s=o.find(t).outerHeight()):i.length>1?(o.css("margin",0),h=o.outerWidth(),s=o.outerHeight()):(o.css("margin",0),h=i.outerWidth(),s=i.outerHeight()),"absolute"===l&&o.css("position",l),{window_w:c,window_h:n,body_w:r,body_h:e,width:h,height:s}},o.prototype.prefixedEventListener=function(o,t,i){var s;for(s=0;s<this.pfx.length;)this.pfx[s]||(t=t.toLowerCase()),o[0]&&o[0].addEventListener(this.pfx[s]+t,i,!1),s++},o.prototype.prefixedRemoveEventListener=function(o,t,i){var s;for(s=0;s<this.pfx.length;)this.pfx[s]||(t=t.toLowerCase()),o[0]&&o[0].removeEventListener(this.pfx[s]+t,i,!1),s++},o}();
